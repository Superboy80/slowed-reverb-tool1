<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Slowed + Reverb Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #111;
      color: #fff;
      padding: 20px;
    }
    h1 { color: #00ffcc; }
    .container {
      margin-top: 20px;
      padding: 20px;
      background: #222;
      border-radius: 10px;
    }
    input, button {
      margin: 10px;
      padding: 10px;
      border-radius: 5px;
      border: none;
    }
    .slider {
      width: 80%;
    }
    #progress {
      margin-top: 10px;
      height: 20px;
      width: 80%;
      background: #333;
      border-radius: 10px;
      overflow: hidden;
      display: none;
      margin-left: auto;
      margin-right: auto;
    }
    #progress-bar {
      height: 100%;
      width: 0%;
      background: #00ffcc;
    }
    audio { margin-top: 15px; }
    .note {
      font-size: 14px;
      color: #aaa;
    }
  </style>
</head>
<body>
  <h1>üéµ Slowed + Reverb Tool</h1>
  <div class="container">
    <input type="file" id="audioFile" accept="audio/*"><br>
    
    <label>Playback Speed (0.5x ‚Äì 1.5x):</label><br>
    <input type="range" id="speed" class="slider" min="0.5" max="1.5" value="0.85" step="0.05">
    <span id="speedValue">0.85x</span><br><br>
    
    <label>Reverb Level:</label><br>
    <input type="range" id="reverb" class="slider" min="0" max="100" value="60">
    <span id="reverbValue">60%</span><br><br>
    
    <button onclick="processAudio()">Process Audio</button>
    
    <div id="progress">
      <div id="progress-bar"></div>
    </div>
    
    <p class="note">‚ú® Best settings: Speed 0.85x, Reverb 60%</p>
    
    <audio id="outputAudio" controls></audio><br>
    <button id="downloadBtn" style="display:none;">Download Processed File</button>
  </div>

  <script>
    const fileInput = document.getElementById('audioFile');
    const speedSlider = document.getElementById('speed');
    const reverbSlider = document.getElementById('reverb');
    const speedValue = document.getElementById('speedValue');
    const reverbValue = document.getElementById('reverbValue');
    const progress = document.getElementById('progress');
    const progressBar = document.getElementById('progress-bar');
    const outputAudio = document.getElementById('outputAudio');
    const downloadBtn = document.getElementById('downloadBtn');

    speedSlider.oninput = () => speedValue.textContent = speedSlider.value + "x";
    reverbSlider.oninput = () => reverbValue.textContent = reverbSlider.value + "%";

    async function processAudio() {
      const file = fileInput.files[0];
      if (!file) return alert("‚ö†Ô∏è Please select an audio file.");
      if (file.size > 10 * 1024 * 1024) { // 10MB
        return alert("‚ö†Ô∏è File too large! Max 10MB allowed.");
      }

      progress.style.display = "block";
      progressBar.style.width = "0%";

      // Simulated progress
      let i = 0;
      const interval = setInterval(() => {
        if (i >= 100) { clearInterval(interval); }
        progressBar.style.width = i + "%";
        i += 10;
      }, 200);

      try {
        const url = URL.createObjectURL(file);
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const response = await fetch(url);
        const arrayBuffer = await response.arrayBuffer();
        const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

        // Playback node
        const source = audioCtx.createBufferSource();
        source.buffer = audioBuffer;
        source.playbackRate.value = speedSlider.value;

        // Reverb (simple convolver replacement)
        const gainNode = audioCtx.createGain();
        gainNode.gain.value = reverbSlider.value / 100;

        source.connect(gainNode).connect(audioCtx.destination);
        source.start();

        outputAudio.src = url;
        outputAudio.play();

        downloadBtn.style.display = "inline-block";
        downloadBtn.onclick = () => {
          const a = document.createElement("a");
          a.href = url;
          a.download = "slowed-reverb.mp3";
          a.click();
        };

      } catch (err) {
        alert("‚ùå Render error: Device may be low on memory.");
        console.error(err);
      }
    }
  </script>
</body>
</html>
