<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lofi Beat Generator</title>
  <meta name="description" content="Simple Lofi beat generator — play, tweak, record & download. Hosted on GitHub Pages." />

  <style>
    :root{
      --bg1: #0f1724;
      --bg2: #24263a;
      --accent: #ffb6c1;
      --muted: #cbd5e1;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family:Inter,"Poppins",system-ui;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
    }
    .app{
      width:100%;
      max-width:900px;
      background:rgba(255,255,255,0.05);
      border-radius:12px;
      padding:24px;
      box-shadow:0 8px 30px rgba(0,0,0,0.5);
    }
    header h1{margin:0;font-size:28px}
    .subtitle{color:var(--muted);margin-bottom:20px}
    .row{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:10px}
    input[type=range]{width:280px}
    .btn{
      border:none;
      padding:10px 15px;
      border-radius:8px;
      background:rgba(255,255,255,0.08);
      color:#fff;
      cursor:pointer;
      transition:all .15s;
    }
    .btn:hover{transform:translateY(-2px);background:rgba(255,255,255,0.12)}
    .primary{background:linear-gradient(90deg,var(--accent),#ffd7e6);color:#222;font-weight:600}
    footer{text-align:center;color:var(--muted);font-size:13px;margin-top:15px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>🎧 Lofi Beat Generator</h1>
      <p class="subtitle">Play • Tweak • Record • Download</p>
    </header>

    <main>
      <div class="row">
        <label>Tempo: <span id="tempoVal">80</span> BPM</label>
        <input type="range" id="tempo" min="60" max="120" value="80">
      </div>

      <div class="row">
        <label>Swing:
          <input type="range" id="swing" min="0" max="0.9" step="0.01" value="0.15">
          <span id="swingVal">0.15</span>
        </label>
      </div>

      <div class="row">
        <label>Pattern:
          <select id="pattern">
            <option value="basic">Basic Boom-Bap</option>
            <option value="chill">Chill Groove</option>
            <option value="custom">Random</option>
          </select>
        </label>
      </div>

      <div class="row">
        <button id="playBtn" class="btn primary">Play</button>
        <button id="stopBtn" class="btn">Stop</button>
        <button id="recordBtn" class="btn">Start Recording</button>
        <button id="downloadBtn" class="btn" disabled>Download</button>
      </div>

      <div class="row">
        <label><input type="checkbox" id="vinyl"> Add vinyl crackle</label>
        <label><input type="checkbox" id="pad"> Add mellow pad</label>
      </div>

      <div class="row">
        <span>Status: <b id="status">idle</b></span>
      </div>
    </main>

    <footer>
      <small>Made with 💖 using Tone.js — Host on GitHub Pages</small>
    </footer>
  </div>

  <!-- Tone.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
  <script>
    // 🎵 Instruments
    const synth = new Tone.PolySynth(Tone.Synth).toDestination();
    const kick = new Tone.MembraneSynth().toDestination();
    const snare = new Tone.NoiseSynth({ envelope: { attack: 0.01, decay: 0.2, sustain: 0 } }).toDestination();
    const hihat = new Tone.MetalSynth().toDestination();
    const pad = new Tone.PolySynth(Tone.AMSynth).toDestination();

    const reverb = new Tone.Reverb({ decay: 3, wet: 0.3 }).toDestination();
    const filter = new Tone.Filter(1200, "lowpass").toDestination();
    synth.connect(reverb); reverb.connect(filter);
    pad.connect(reverb); reverb.connect(filter);
    kick.connect(filter); snare.connect(filter); hihat.connect(filter);

    // 🎛️ Controls
    const tempo = document.getElementById('tempo');
    const swing = document.getElementById('swing');
    const pattern = document.getElementById('pattern');
    const statusEl = document.getElementById('status');
    const vinyl = document.getElementById('vinyl');
    const padChk = document.getElementById('pad');
    const recordBtn = document.getElementById('recordBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    document.getElementById('tempoVal').innerText = tempo.value;
    document.getElementById('swingVal').innerText = swing.value;
    tempo.oninput = () => {Tone.Transport.bpm.value = tempo.value; document.getElementById('tempoVal').innerText = tempo.value;};
    swing.oninput = () => {Tone.Transport.swing = swing.value; document.getElementById('swingVal').innerText = swing.value;};

    const patterns = {
      basic: ["K","H","-","H","S","H","-","H"],
      chill: ["K","H","H","H","S","H","-","H"],
      custom: null
    };

    function randomPattern(){
      return Array(8).fill('-').map(()=>['K','S','H','-'][Math.floor(Math.random()*4)]);
    }

    let index=0, recorder, recorded=[];
    function schedule(){
      Tone.Transport.cancel();
      const pat = pattern.value==="custom"?randomPattern():patterns[pattern.value];
      Tone.Transport.scheduleRepeat(time=>{
        const step = pat[index%pat.length];
        if(step==='K') kick.triggerAttackRelease("C2","8n",time);
        if(step==='S') snare.triggerAttackRelease("8n",time);
        if(step==='H') hihat.triggerAttackRelease("16n",time);
        if(index%4===0) (padChk.checked?pad:synth).triggerAttackRelease(["C4","E4","G4"],"2n",time,0.6);
        index++;
      },"8n");
    }

    document.getElementById('playBtn').onclick = async ()=>{
      await Tone.start();
      statusEl.innerText='playing';
      schedule();
      Tone.Transport.bpm.value = tempo.value;
      Tone.Transport.start();
    };
    document.getElementById('stopBtn').onclick = ()=>{
      Tone.Transport.stop();
      Tone.Transport.cancel();
      statusEl.innerText='stopped';
    };

    // 🎙️ Recording
    function setupRecorder(){
      const dest = Tone.context.createMediaStreamDestination();
      filter.connect(dest);
      recorder = new MediaRecorder(dest.stream);
      recorder.ondataavailable = e=>recorded.push(e.data);
      recorder.onstop=()=>downloadBtn.disabled=false;
    }

    recordBtn.onclick=async()=>{
      if(!recorder) setupRecorder();
      if(recordBtn.textContent.includes('Start')){
        recorded=[];
        recorder.start();
        recordBtn.textContent='Stop Recording';
        statusEl.innerText='recording';
        if(Tone.Transport.state!=='started'){schedule();Tone.Transport.start();}
      } else {
        recorder.stop();
        recordBtn.textContent='Start Recording';
        statusEl.innerText='saved';
      }
    };

    downloadBtn.onclick=()=>{
      const blob=new Blob(recorded,{type:'audio/webm'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url;
      a.download='lofi-beat.webm';
      a.click();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>
